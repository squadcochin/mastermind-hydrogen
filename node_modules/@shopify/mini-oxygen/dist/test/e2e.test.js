"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const vitest_1 = require("vitest");
const preview_1 = require("../preview");
const utils_1 = require("./utils");
(0, vitest_1.describe)('preview()', () => {
    let fixture;
    const defaultOptions = {
        log: vitest_1.vi.fn(),
    };
    (0, vitest_1.beforeEach)(async () => {
        fixture = await (0, utils_1.createFixture)('basic-fixture');
    });
    (0, vitest_1.afterEach)(async () => {
        await fixture.destroy();
    });
    (0, vitest_1.it)('displays a message when the server is running', async () => {
        const mockLogger = vitest_1.vi.fn();
        await (0, preview_1.preview)({
            ...defaultOptions,
            log: mockLogger,
            port: fixture.port,
            workerFile: fixture.paths.workerFile,
        });
        (0, vitest_1.expect)(mockLogger).toHaveBeenCalledWith(`\nStarted miniOxygen server. Listening at http://localhost:${fixture.port}\n`);
    });
});
