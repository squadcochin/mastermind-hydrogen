"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.viteception = void 0;
const vite_1 = require("vite");
const vite_js_1 = require("../utilities/vite.js");
async function viteception(paths, options) {
    const isWorker = process.env.WORKER;
    delete process.env.WORKER;
    const server = await (0, vite_1.createServer)({
        clearScreen: false,
        server: {
            middlewareMode: vite_js_1.isVite3 ? true : 'ssr',
            hmr: false,
        },
        // @ts-ignore
        appType: 'custom',
        ...options,
    });
    if (isWorker) {
        process.env.WORKER = isWorker;
    }
    const loaded = await Promise.all(paths.map((path) => server.ssrLoadModule(path)));
    await server.close();
    return { server, loaded };
}
exports.viteception = viteception;
